<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>活动管理-选择优惠券</title>
	<link rel="stylesheet" type="text/css" href="/weixinpl/common/css_V6.0/content.css">
	<link rel="stylesheet" type="text/css" href="/weixinpl/common/css_V6.0/contentblue.css">
	<link rel="stylesheet" type="text/css" href="/mshop/web/static/css/swiper.min.css">
	<script type="text/javascript" src="/weixinpl/common/js/jquery-2.1.0.min.js"></script>
	<style type="text/css">
		.award-main{overflow:hidden;margin:25px 38px;border-radius:5px;border:solid 1px #d8d8d8;}
		.award-nav{font-size:0;height:55px;background-color:#fafafa;border-bottom:solid 1px #d8d8d8;}
		.award-nav a{display:inline-block;vertical-align:top;margin:0 0 -1px 0;line-height:55px;border-bottom:solid 1px rgba(0,0,0,0);font-size:14px;color:#646464;padding:0 15px;}
		.award-content{padding:0 10px;}
		.rotate{-ms-transform:rotate(180deg);-webkit-transform:rotate(180deg);transform:rotate(180deg);}
		.award-swiper{max-width:880px;padding:0 30px 0 40px;position:relative;display:inline-block;margin:30px 0;}
		.swiper-next,.swiper-prev{background:none;border:0;position:absolute;top:11px;outline:none;}
		.swiper-next{right:0;}
		.swiper-prev{left:0;}
		.swiper-slide{width:100px;height:46px;text-align:center;line-height:46px;background-color:#f5f6fa;cursor:pointer;}
		.swiper-slide .name{box-sizing:border-box;padding:0 10px;font-size:14px;color:#646464;}
		.swiper-slide .del-tab{position:absolute;width:8px;height:8px;background-image:url(/mshop/web/static/images/slyder_adventures/icon-del.png);background-repeat:no-repeat;top:4px;right:4px;z-index:5;}
		.swiper-slide.WSY-skin-bg .name{color:#fff;}
		.swiper-slide.WSY-skin-bg .del-tab{background-image:url(/mshop/web/static/images/slyder_adventures/icon-del-w.png);}
		.add-slide{font-size:40px;color:#979797;}
		.label-box{vertical-align:middle;display:inline-block;margin:0 20px 0 0;font-size:14px;}
		.label-box input{vertical-align:middle;margin:0 5px 0 0;}
		.remarks{display:inline-block;height:26px;color:red;box-sizing:border-box;padding:8px 0 0 0;vertical-align:middle;margin:0 0 0 10px;}
		.award-list{margin:0 50px 20px 50px;}
		.award-tab{display:none;}
		.award-tab.active{display:block;}
		.award-tab .ipt{height:26px;box-sizing:border-box;padding:0 10px;border:solid 1px #dddddd;font-size:14px;vertical-align:top;color:#646464;}
		.award-tab .list{font-size:0;margin:15px 0 0 0;}
		.award-left,.award-right{display:inline-block;vertical-align:top;font-size:14px;color:#646464;}
		.award-left{line-height:26px;min-width:100px;}
		.award-right{min-width:500px;}
		.choice-name{display:inline-block;line-height:26px;vertical-align:top;font-size:14px;color:#646464;}
		.choice-box{display:inline-block;height:26px;font-size:0;}
		.choice-box .ipt{min-width:150px;}
		.choice-box .btn{border:0;height:26px;min-width:73px;font-size:14px;color:#fff;border-radius:0;margin:0 0 0 10px;vertical-align:top;line-height:1;}
		.award-ipt{min-width:177px;}
		.careful{display:inline-block;width:22px;height:22px;text-align:center;line-height:22px;background-color:#e74c3c;color:#fff;border-radius:50%;margin:0 0 0 10px;cursor:pointer;}
		.up-img-box{position:relative;width:111px;height:111px;border:dashed 1px #ddd;cursor:pointer;}
		.up-img-box #up-img{width:100%;height:100%;}
		.up-img-box .files{position:absolute;width:100%;height:100%;top:0;left:0;opacity:0;}
		.footer-button{margin:30px 0 30px 50px;}
		.footer-button .btn{height:40px;min-width:120px;border-radius:2px;cursor:pointer;color:#fff;font-size:16px;margin:0 10px;background-color:#999;}
	</style>
</head>
<body>
	<div class="WSY_content">
		<div class="WSY_columnbox">
			<div class="WSY_data">
				<div class="WSY_list" id="WSY_list" style="min-height: 500px;">
					<div class="WSY_left"><a>优惠券列表</a></div>
						
					<div class="WSY_search_q search" id="search_form" style="display:block;">
					
						<li class="">优惠券编码： <input type="text" name="search_id" id="search_id" value="<?php echo $search_id; ?>" style="width:150px;"></li>
						<li class="">优惠券名称： <input type="text" name="search_title" id="search_title" value="<?php echo $search_title; ?>" style="width:150px;"></li>
						<li class="">类型： 
							<select id="search_class_type">
								<option value="0" <?php if($search_class_type==0){echo "selected";} ?> >--全部--</option>
								<option value="1" <?php if($search_class_type==1){echo "selected";} ?> >普通优惠券</option>
								<option value="2" <?php if($search_class_type==2){echo "selected";} ?> >首次领取优惠券</option>
								<option value="3" <?php if($search_class_type==3){echo "selected";} ?> >拼团团长免单券</option>
							</select>
						</li>
						<ul>
						  <li class="WSY_bottonliss"><input style="padding-right:0;width: 70px;cursor:pointer;" type="button" class="search_btn" onclick="searchForm();" value="搜索"></li>
						  <li class="WSY_bottonliss"><input style="padding-right:0;width: 70px;cursor:pointer;" type="button" class="search_btn" onclick="saveChoice();" value="保存"></li>
						</ul>
					</div>

					<table width="97%" class="WSY_table WSY_t2" id="WSY_t1">
					  <thead class="WSY_table_header">
						<tr>
							<th width="3%"></th>
							<th width="4%">优惠劵编码</th>
							<th width="11%">优惠券名称</th>
							<th width="8%">优惠券类型</th>
							<th width="11%">使用条件</th>
							<th width="17%">领取时间</th>
							<th width="17%">使用时间</th>
							<th width="4%">发行数量</th>
							<th width="4%">剩余数量</th>
						</tr>
					  </thead>
					  
					  <tbody>
						<?php 
							if(empty($list)){
								echo '<tr><td colspan="9" style="text-align:center;color:red">暂无数据</td></tr>';
							}else{
								foreach($list as $k=>$v){
								$class_type_str = "普通优惠券";
								if( $v['class_type'] == 2 ){
									$class_type_str = "首次领取优惠券";
								} else if( $v['class_type'] == 3 ){
									$class_type_str = "拼团团长免单券";
								}
								
								$is_use_str = "";
								//'使用者身份限制 1.粉丝 2.推广员 3.股东1 4.股东2 5.股东3 6.股东4（最高级别股东），多个身份时，用下划线“_”分隔，如：1_2_3，默认全选'
								if( strpos($v['use_roles'],"1")!==false ){
									$is_use_str .= " 粉丝 ";
								}
								if( strpos($v['use_roles'],"2")!==false ){
									$is_use_str .= " 推广员 ";
								}
								if( strpos($v['use_roles'],"3")!==false ){
									$is_use_str .= " {$a_name} ";
								}
								if( strpos($v['use_roles'],"4")!==false ){
									$is_use_str .= " {$b_name} ";
								}
								if( strpos($v['use_roles'],"5")!==false ){
									$is_use_str .= " {$c_name} ";
								}
								if( strpos($v['use_roles'],"6")!==false ){
									$is_use_str .= " {$d_name} ";
								}
								
								$couponNum_str = $v['couponNum'];
								if($v['couponNum'] == -1){
								   $couponNum_str = "不限";
								}
								$storenum_str	= $v['storenum'];
								if($v['storenum'] == -1 || $v['couponNum'] == -1){
								   $storenum_str = "不限";
								}
						?>
						<tr>
							<td align="center" data-id="<?php echo $v["id"]; ?>" data-title="<?php echo htmlspecialchars($v["title"]); ?>" ><input type="radio" class="coupon_sel" name="coupon_val" value="<?php echo $v["id"]; ?>"></td>
							<td align="center"><?php echo $v["id"]; ?></td>
							<td align="center"><?php echo htmlspecialchars($v["title"]); ?></td>
							<td align="center"><?php echo $class_type_str; ?></td>
							<td align="center"><?php if($v['NeedMoney']>=0){?>
								<dt>满<?php echo $v['NeedMoney']; ?>元可用</dt>
								<?php }else{ ?>
								<dt>不限金额可用</dt>	
								<?php } ?>
								<dt>可使用身份：<?php echo $is_use_str; ?></dt>
							</td>
							<td align="center"><?php echo $v['getStartTime']; ?>至<?php echo $v['getEndTime']; ?></td>
							<td align="center">
								<?php if($v['DaysType']){ ?>
									<?php echo $v['startline']; ?>至<?php echo $v['Days']; ?>
								<?php }else{ ?>
									<?php echo date("Y-m-d H:i:s",time()); ?>至<?php echo date('Y-m-d H:i:s',strtotime("+".$v['Days']." day")); ?>
								<?php } ?>
							</td>
							<td align="center"><?php echo $couponNum_str; ?></td>
							<td align="center"><dt><?php echo $storenum_str; ?></dt></td>
						 </tr>
						 <?php }
							} ?>
					  </tbody>
					</table>
					<!--表格结束-->
			
					<!--翻页开始-->
					<div class="WSY_page"></div>
					<!--翻页结束-->	
				</div>

            </div>
            
            <div style="width:100%;height:20px;"></div>
		</div>
	</div>
	<script src="/weixinpl/js/fenye/jquery.page1.js"></script>
	<script type="text/javascript" src="/weixinpl/common/js/layer/V2_1/layer.js"></script>
	<script type="text/javascript">
		var index = parent.layer.getFrameIndex(window.name);//获取子窗口索引
		var customer_id   = <?php echo $customer_id; ?>;
		var customer_id_en= '<?php echo $customer_id_en; ?>';
		
		var pageNum = <?php echo $pageNum ?>;
		var count =<?php echo $pageCount ?>;//总页数
		//pageCount：总页数
		//current：当前页

	  $(".WSY_page").createPage({
		  pageCount:count,
		  current:pageNum,
		  backFn:function(p){
			  gopage(p);
		  }
	  });

	  function jumppage(){
		var a=parseInt($("#WSY_jump_page").val());
		if((a<1) || isNaN(a)){
			layer.alert('请输入正确的页数');
			return false;
		}else{
			gopage(a);
		}
	 }
	  var page = <?php echo $pageCount ?>;
	  
	  function gopage(a){
		var search_id         = document.getElementById("search_id").value;
		var search_title      = document.getElementById("search_title").value;
		var search_class_type = document.getElementById("search_class_type").value; 
		document.location= "/mshop/admin/index.php?m=slyder_adventures&a=coupon_list&customer_id="+customer_id_en+"&pageNum="+a+"&search_id="+search_id+"&search_title="+search_title+"&search_class_type="+search_class_type;
	 }

	 //搜索
	  function searchForm(){
		 gopage(pageNum)
	  }

	 
	  //保存选择并回传
	  function saveChoice(){
		var coupon_val  = $("input[name='coupon_val']:checked").val();
		if( coupon_val == "" || coupon_val == undefined ){
			layer.msg("请先选择优惠券！", {icon: 5,time:1500,shade: 0.1});
			return false;
		}
		$('.coupon_sel').each(function(item,obj){
			if($(obj).is(':checked')){
				var coupon_id   = $(obj).parent().data("id");
				var coupon_title = $(obj).parent().data("title");
				parent.showCouponCallback(coupon_id,coupon_title);			//回调函数
				parent.layer.close(index);
				
				return;
			}
		});
	  }
	</script>	
</body>
</html>